#!/usr/bin/env bash
set -euxo pipefail
cd "$(dirname "$(realpath "$0")")/.."

bin/demo-cleanup

DFX_NETWORK=local
export DFX_NETWORK

dfx start --clean --background
sleep 1

dfx nns install

dfx nns import
dfx sns import

rm -fr "$HOME/.config/dfx/identity/snsdemo8"
dfx identity new --disable-encryption snsdemo8
dfx identity use snsdemo8

bin/dfx-ledger-get-icp --icp 900000000 --network "$DFX_NETWORK"
bin/dfx-neuron-create --icp 500000000 --network "$DFX_NETWORK"
bin/dfx-neuron-prolong --network "$DFX_NETWORK"

./bin/dfx-sns-whitelist-me --network "$DFX_NETWORK"

./bin/dfx-sns-config-random --network "$DFX_NETWORK"
./bin/dfx-sns-deploy --network "$DFX_NETWORK"

dfx canister id sns_root --network "$DFX_NETWORK"
dfx canister id sns_governance --network "$DFX_NETWORK"
dfx canister id sns_ledger --network "$DFX_NETWORK"
dfx canister id sns_swap --network "$DFX_NETWORK"

: "Demo finished!  Hope you enjoyed the show."
