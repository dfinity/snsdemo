#!/usr/bin/env bash
set -euo pipefail

test_install() {
	(
	local flags=("${@}")
  echo "Before importing, checking for ckBTC should fail:"
  if bin/dfx-ckbtc-import --check "${flags[@]}"; then
    echo "ERROR: Check should fail without ckBTC canisters"
    exit 1
  fi
  echo "Now import"
  bin/dfx-ckbtc-import "${flags[@]}"
  echo "After importing, checking for ckBTC should succeed"
  bin/dfx-ckbtc-import --check "${flags[@]}"
) |& sed 's/^/    /g'
}

(
  echo "Default canister installation should work"
  test_install
)

(
  echo "Installation with a prefix should work"
  for prefix in "" foo; do
    test_install --prefix "$prefix"
  done
)
