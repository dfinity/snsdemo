#!/usr/bin/env bash
SOURCE_DIR="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
PATH="$SOURCE_DIR:$PATH"

# Source the clap.bash file ---------------------------------------------------
source "$SOURCE_DIR/clap.bash"
# Define options
# Source the output file ----------------------------------------------------------
source "$(clap.build)"
set -euo pipefail

file="$(realpath "$1")"

pushd "$HOME"
unzip -q "$file"
# Note: dfx start works here but not in the project dir.  Strange.
dfx start --background
num_canisters="$(curl -s "http://localhost:$(dfx info replica-port)/_/dashboard" | grep '<h3>Execution state</h3>' | wc -l)"
popd
mv "$HOME/.dfx" .
dfx identity list
dfx identity use snsdemo8
cat .dfx/local/canister_ids.json
echo "Approx num canisters: $num_canisters"
dfx-sns-demo-healthcheck
