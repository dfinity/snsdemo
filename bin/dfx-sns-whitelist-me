#!/usr/bin/env bash
set -euo pipefail
SOURCE_DIR="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
PATH="$SOURCE_DIR:$PATH:$(dfx cache show)"
export PATH

# Source the clap.bash file ---------------------------------------------------
source "$SOURCE_DIR/clap.bash"
# Define options
clap.define short=i long=identity desc="The dfx identity to use" variable=DFX_IDENTITY default="$(dfx identity whoami)"
clap.define short=i long=proposer desc="The dfx identity that creates the proposal" variable=DFX_PROPOSER default=""
clap.define short=n long=network desc="The dfx network to use" variable=DFX_NETWORK default="local"
# Source the output file ----------------------------------------------------------
source "$(clap.build)"

DFX_PROPOSER="${DFX_PROPOSER:-$DFX_IDENTITY}"
DFX_NEURON_ID="$(dfx-neuron-id --identity "$DFX_PROPOSER" --network "$DFX_NETWORK")"
DFX_PROPOSER_PEM="$HOME/.config/dfx/identity/$DFX_PROPOSER/identity.pem"
export NNS_URL DFX_PROPOSER_PEM DFX_NEURON_ID
NNS_URL="$(dfx-network-provider --network "$DFX_NETWORK")"
command -v "ic-admin"
set ic-admin \
  --secret-key-pem "$DFX_PROPOSER_PEM" \
  --nns-url "$NNS_URL" \
  propose-to-update-sns-deploy-whitelist \
  --added-principals "$(dfx identity get-wallet --network "$DFX_NETWORK" --identity "$DFX_IDENTITY")" \
  --proposer "$DFX_NEURON_ID" \
  --proposal-title "Let me SNS!" \
  --summary "I am a nice guy, I won't try to break the baby when it's just born."
printf ' "%q"' "${@}"
echo
"${@}"
