#!/usr/bin/env bash
SOURCE_DIR="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
PATH="$SOURCE_DIR:$PATH:$(dfx cache show)"
export PATH="$PATH:$HOME/.local/bin"

# Source the optparse.bash file ---------------------------------------------------
source "$SOURCE_DIR/optparse.bash"
# Define options
optparse.define short=n long=network desc="The dfx network to use" variable=DFX_NETWORK default="local"
# Source the output file ----------------------------------------------------------
source "$(optparse.build)"
set -euxo pipefail
cd "$(dirname "$(realpath "$0")")/.."

bin/dfx-ledger-get-icp --max --icp 100 --network "$DFX_NETWORK"
dfx ledger balance --network "$DFX_NETWORK"

bin/dfx-neuron-id --network "$DFX_NETWORK" || {
  bin/dfx-neuron-create --icp 50 --network "$DFX_NETWORK" --verbose
  bin/dfx-neuron-prolong --network "$DFX_NETWORK"
}

./bin/dfx-sns-config-random --network "$DFX_NETWORK"
dfx-wallet-top-up --to 200 --amount 2.0 --network "$DFX_NETWORK"
./bin/dfx-sns-deploy --network "$DFX_NETWORK"

dfx canister id sns_root --network "$DFX_NETWORK"
dfx canister id sns_governance --network "$DFX_NETWORK"
dfx canister id sns_ledger --network "$DFX_NETWORK"
dfx canister id sns_swap --network "$DFX_NETWORK"

: hand over control of the dapp. Skipped...

dfx-sns-sale-propose --network "$DFX_NETWORK"

dfx-sns-sale-buy --network "$DFX_NETWORK"

: "Demo finished!  Hope you enjoyed the show."
