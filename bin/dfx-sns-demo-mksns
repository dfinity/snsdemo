#!/usr/bin/env bash
set -euo pipefail
SOURCE_DIR="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
DEMO_BIN="$(realpath "${SOURCE_DIR}/../bin-other")"
PATH="$DEMO_BIN:$SOURCE_DIR:$PATH:$(dfx cache show)"
export PATH="$PATH:$HOME/.local/bin"

# Source the clap.bash file ---------------------------------------------------
source "$SOURCE_DIR/clap.bash"
# Define options
clap.define short=n long=network desc="The dfx network to use" variable=DFX_NETWORK default="local"
clap.define long=confirmation_text desc="A text that needs to be confirmed by the participants" variable=CONFIRMATION_TEXT default=""
# Source the output file ----------------------------------------------------------
source "$(clap.build)"
set -x
cd "$(dirname "$(realpath "$0")")/.."

./bin/dfx-sns-whitelist-me --network "$DFX_NETWORK"

./bin/dfx-sns-config-random --confirmation_text "${CONFIRMATION_TEXT:-}"
dfx ledger top-up --amount 2.0 --network "$DFX_NETWORK" "$(dfx identity get-wallet --network "$DFX_NETWORK")"
./bin/dfx-sns-deploy --network "$DFX_NETWORK"

dfx canister id sns_root --network "$DFX_NETWORK"
dfx canister id sns_governance --network "$DFX_NETWORK"
dfx canister id sns_ledger --network "$DFX_NETWORK"
dfx canister id sns_swap --network "$DFX_NETWORK"

: hand over control of the dapp. Skipped...

dfx-sns-sale-propose --network "$DFX_NETWORK"
